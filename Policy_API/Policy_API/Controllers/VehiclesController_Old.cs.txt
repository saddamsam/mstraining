using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Policy_API.Models;
using Policy_API.Repository;

namespace Policy_API.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class VehiclesController : ControllerBase
    {
        private IVehicleRepo _vehicleRepo;

        public VehiclesController(IVehicleRepo vehicleRepo)
        {
            _vehicleRepo = vehicleRepo;
        }

        [HttpGet]
        public async Task<IEnumerable<Vehicle>> Get()
        {
            return await _vehicleRepo.GetAllvehicle();
        }

        [HttpGet("{registrationNo}")]
        public async Task<Vehicle> Get(string registrationNo)
        {
            return await _vehicleRepo.GetVehicleByRegNo(registrationNo);
        }

        [HttpPost]
        public async Task<IActionResult> Post(Vehicle vehicle)
        {
            var result = await _vehicleRepo.AddVehicle(vehicle);
            return CreatedAtAction(nameof(Get),new { id = vehicle.RegistrationNo },result);
        }

        [HttpDelete("{Registration_No}")]
        public async Task<IActionResult> Delete(string Registration_No)
        {
            var result = await _vehicleRepo.DeleteVehicle(Registration_No);
            if(result == true)
            {
                return new OkResult();
            }
            else
            {
                return new BadRequestResult();
            }
        }
    }
}
